<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2032px" preserveAspectRatio="none" style="width:1071px;height:2032px;" version="1.1" viewBox="0 0 1071 2032" width="1071px" zoomAndPan="magnify"><defs><filter height="300%" id="fmoi6pl9o1b93" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fmoi6pl9o1b93)" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="260" x="13" y="286.7188"/><rect fill="#FFFFFF" filter="url(#fmoi6pl9o1b93)" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="251" x="13" y="851.3984"/><rect fill="#FFFFFF" filter="url(#fmoi6pl9o1b93)" height="139.7578" style="stroke: #000000; stroke-width: 2.0;" width="231.5" x="817.5" y="1175.6172"/><rect fill="#FFFFFF" filter="url(#fmoi6pl9o1b93)" height="139.7578" style="stroke: #000000; stroke-width: 2.0;" width="231.5" x="817.5" y="1329.375"/><rect fill="#FFFFFF" filter="url(#fmoi6pl9o1b93)" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="251" x="13" y="1620.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="38" x2="38" y1="87.6094" y2="2020.4609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="162.5" x2="162.5" y1="87.6094" y2="2020.4609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="260.5" x2="260.5" y1="87.6094" y2="2020.4609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="574.5" x2="574.5" y1="87.6094" y2="2020.4609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="876.5" x2="876.5" y1="87.6094" y2="2020.4609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1021" x2="1021" y1="87.6094" y2="2020.4609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="20" x="25" y="84.5332">PO</text><ellipse cx="38" cy="13" fill="#FEFECE" filter="url(#fmoi6pl9o1b93)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38,21 L38,48 M25,29 L51,29 M38,48 L25,63 M38,48 L51,63 " fill="none" filter="url(#fmoi6pl9o1b93)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fmoi6pl9o1b93)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="118.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="125.5" y="72.5332">PO Reader</text><rect fill="#FEFECE" filter="url(#fmoi6pl9o1b93)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="217.5" y="33.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="230" y="54.9238">Ticketing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="224.5" y="72.5332">application</text><rect fill="#FEFECE" filter="url(#fmoi6pl9o1b93)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="525.5" y="33.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="547" y="54.9238">Calypso</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="532.5" y="72.5332">Terminal API</text><rect fill="#FEFECE" filter="url(#fmoi6pl9o1b93)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="827.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="834.5" y="72.5332">SAM Reader</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="1004" y="84.5332">SAM</text><ellipse cx="1021.5" cy="13" fill="#FEFECE" filter="url(#fmoi6pl9o1b93)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M1021.5,21 L1021.5,48 M1008.5,29 L1034.5,29 M1021.5,48 L1008.5,63 M1021.5,48 L1034.5,63 " fill="none" filter="url(#fmoi6pl9o1b93)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#EEEEEE" filter="url(#fmoi6pl9o1b93)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1056" x="3" y="118.7852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1059" y1="118.7852" y2="118.7852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1059" y1="121.7852" y2="121.7852"/><rect fill="#EEEEEE" filter="url(#fmoi6pl9o1b93)" height="24.3516" style="stroke: #000000; stroke-width: 2.0;" width="124" x="469" y="107.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="475" y="125.1045">PO Identification</text><polygon fill="#A80036" points="562.5,176.6641,572.5,180.6641,562.5,184.6641,566.5,180.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260.5" x2="568.5" y1="180.6641" y2="180.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="267.5" y="159.4561">transmit(SeRequest(AID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="267.5" y="175.8076">List&lt;PoRequestOutSession&gt;))</text><polygon fill="#0000FF" points="174,207.0156,164,211.0156,174,215.0156,170,211.0156" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="168" x2="573.5" y1="211.0156" y2="211.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="180" y="206.1592">PO 1: SeRequest(AID, List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="49,237.3672,39,241.3672,49,245.3672,45,241.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43" x2="162" y1="241.3672" y2="241.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="55" y="236.5107">SelectApplication</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="271.7188" y2="267.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="271.7188" y2="275.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="38" x2="162" y1="271.7188" y2="271.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="45" y="266.8623">PO serial</text><path d="M13,286.7188 L268,286.7188 L268,294.7188 L258,304.7188 L13,304.7188 L13,286.7188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="260" x="13" y="286.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="28" y="301.2139">'x' PO commands outside session</text><polygon fill="#A80036" points="49,323.4219,39,327.4219,49,331.4219,45,327.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43" x2="162" y1="327.4219" y2="327.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="55" y="322.5654">ApduRequest</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="357.7734" y2="353.7734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="357.7734" y2="361.7734"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="38" x2="162" y1="357.7734" y2="357.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="45" y="352.917">ApduResponse</text><polygon fill="#0000FF" points="562.5,391.125,572.5,395.125,562.5,399.125,566.5,395.125" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="163" x2="568.5" y1="395.125" y2="395.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="170" y="390.2686">SeResponse(FCI, List&lt;ApduResponse&gt;)</text><polygon fill="#A80036" points="271.5,421.4766,261.5,425.4766,271.5,429.4766,267.5,425.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="265.5" x2="573.5" y1="425.4766" y2="425.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="277.5" y="420.6201">SeResponse(PO_FCI, List&lt;PoResponse&gt;))</text><rect fill="#EEEEEE" filter="url(#fmoi6pl9o1b93)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1056" x="3" y="454.6523"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1059" y1="454.6523" y2="454.6523"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1059" y1="457.6523" y2="457.6523"/><rect fill="#EEEEEE" filter="url(#fmoi6pl9o1b93)" height="24.3516" style="stroke: #000000; stroke-width: 2.0;" width="139" x="461.5" y="443.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="467.5" y="460.9717">PO Secure Session</text><polygon fill="#A80036" points="562.5,512.5313,572.5,516.5313,562.5,520.5313,566.5,516.5313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260.5" x2="568.5" y1="516.5313" y2="516.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="267.5" y="495.3232">processOpening</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="369.5" y="495.3232">(PO_FCI, OpenSessionRequest,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="267.5" y="511.6748">List&lt;PoRequestInSession&gt;)</text><polygon fill="#00FF00" points="864.5,559.2344,874.5,563.2344,864.5,567.2344,868.5,563.2344" style="stroke: #00FF00; stroke-width: 1.0;"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="574.5" x2="870.5" y1="563.2344" y2="563.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="581.5" y="542.0264">CSM 1: SeRequest(noAID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="581.5" y="558.3779">List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="1009.5,589.5859,1019.5,593.5859,1009.5,597.5859,1013.5,593.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="1015.5" y1="593.5859" y2="593.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="883.5" y="588.7295">SelectDiversifier</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="623.9375" y2="619.9375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="623.9375" y2="627.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="876.5" x2="1020.5" y1="623.9375" y2="623.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="893.5" y="619.0811">ack</text><polygon fill="#A80036" points="1009.5,650.2891,1019.5,654.2891,1009.5,658.2891,1013.5,654.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="1015.5" y1="654.2891" y2="654.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="883.5" y="649.4326">GetChallenge</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="684.6406" y2="680.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="684.6406" y2="688.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="876.5" x2="1020.5" y1="684.6406" y2="684.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="893.5" y="679.7842">CSM challenge</text><line style="stroke: #00FF00; stroke-width: 1.0;" x1="574.5" x2="584.5" y1="714.9922" y2="710.9922"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="574.5" x2="584.5" y1="714.9922" y2="718.9922"/><line style="stroke: #00FF00; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="574.5" x2="875.5" y1="714.9922" y2="714.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="591.5" y="710.1357">SeResponse(FCI, List&lt;ApduResponse&gt;)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="260.5" x2="270.5" y1="745.3438" y2="741.3438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260.5" x2="270.5" y1="745.3438" y2="749.3438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="260.5" x2="573.5" y1="745.3438" y2="745.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="277.5" y="740.4873">SessionStatus_Identified</text><polygon fill="#0000FF" points="174,771.6953,164,775.6953,174,779.6953,170,775.6953" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="168" x2="573.5" y1="775.6953" y2="775.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="180" y="770.8389">PO 2: SeRequest(AID, List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="49,802.0469,39,806.0469,49,810.0469,45,806.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43" x2="162" y1="806.0469" y2="806.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="55" y="801.1904">OpenSession</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="836.3984" y2="832.3984"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="836.3984" y2="840.3984"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="38" x2="162" y1="836.3984" y2="836.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="45" y="831.542">PO challenge</text><path d="M13,851.3984 L259,851.3984 L259,859.3984 L249,869.3984 L13,869.3984 L13,851.3984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="251" x="13" y="851.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="28" y="865.8936">'y' PO commands inside session</text><polygon fill="#A80036" points="49,888.1016,39,892.1016,49,896.1016,45,892.1016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43" x2="162" y1="892.1016" y2="892.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="55" y="887.2451">ApduRequest</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="922.4531" y2="918.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="922.4531" y2="926.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="38" x2="162" y1="922.4531" y2="922.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="45" y="917.5967">ApduResponse</text><polygon fill="#0000FF" points="562.5,955.8047,572.5,959.8047,562.5,963.8047,566.5,959.8047" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="163" x2="568.5" y1="959.8047" y2="959.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="170" y="954.9482">SeResponse(FCI, List&lt;ApduResponse&gt;)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="260.5" x2="270.5" y1="990.1563" y2="986.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260.5" x2="270.5" y1="990.1563" y2="994.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="260.5" x2="573.5" y1="990.1563" y2="990.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="277.5" y="985.2998">SessionState_Open, List&lt;PoResponse&gt;</text><polygon fill="#A80036" points="562.5,1049.2109,572.5,1053.2109,562.5,1057.2109,566.5,1053.2109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260.5" x2="568.5" y1="1053.2109" y2="1053.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="95" x="267.5" y="1015.6514">processClosing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="362.5" y="1015.6514">(List&lt;PoRequestInSession&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="267.5" y="1032.0029">List&lt;AnticipatedPoResponse&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="267.5" y="1048.3545">PoRatificationCommand)</text><polygon fill="#00FF00" points="864.5,1095.9141,874.5,1099.9141,864.5,1103.9141,868.5,1099.9141" style="stroke: #00FF00; stroke-width: 1.0;"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="574.5" x2="870.5" y1="1099.9141" y2="1099.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="581.5" y="1078.7061">CSM 2: SeRequest(noAID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="581.5" y="1095.0576">List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="1009.5,1126.2656,1019.5,1130.2656,1009.5,1134.2656,1013.5,1130.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="1015.5" y1="1130.2656" y2="1130.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="883.5" y="1125.4092">DigestInit</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1160.6172" y2="1156.6172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1160.6172" y2="1164.6172"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="876.5" x2="1020.5" y1="1160.6172" y2="1160.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="893.5" y="1155.7607">ack</text><path d="M817.5,1175.6172 L1032.5,1175.6172 L1032.5,1183.6172 L1022.5,1193.6172 L817.5,1193.6172 L817.5,1175.6172 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="139.7578" style="stroke: #000000; stroke-width: 2.0;" width="231.5" x="817.5" y="1175.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="832.5" y="1190.1123">'2 * y' session MAC updates</text><polygon fill="#A80036" points="1009.5,1212.3203,1019.5,1216.3203,1009.5,1220.3203,1013.5,1216.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="1015.5" y1="1216.3203" y2="1216.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="883.5" y="1211.4639">DigestUpdate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1246.6719" y2="1242.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1246.6719" y2="1250.6719"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="876.5" x2="1020.5" y1="1246.6719" y2="1246.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="893.5" y="1241.8154">ack</text><polygon fill="#A80036" points="1009.5,1273.0234,1019.5,1277.0234,1009.5,1281.0234,1013.5,1277.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="1015.5" y1="1277.0234" y2="1277.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="883.5" y="1272.167">DigestUpdate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1307.375" y2="1303.375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1307.375" y2="1311.375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="876.5" x2="1020.5" y1="1307.375" y2="1307.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="893.5" y="1302.5186">ack</text><path d="M817.5,1329.375 L1032.5,1329.375 L1032.5,1337.375 L1022.5,1347.375 L817.5,1347.375 L817.5,1329.375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="139.7578" style="stroke: #000000; stroke-width: 2.0;" width="231.5" x="817.5" y="1329.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="832.5" y="1343.8701">'2 * z' session MAC updates</text><polygon fill="#A80036" points="1009.5,1366.0781,1019.5,1370.0781,1009.5,1374.0781,1013.5,1370.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="1015.5" y1="1370.0781" y2="1370.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="883.5" y="1365.2217">DigestUpdate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1400.4297" y2="1396.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1400.4297" y2="1404.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="876.5" x2="1020.5" y1="1400.4297" y2="1400.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="893.5" y="1395.5732">ack</text><polygon fill="#A80036" points="1009.5,1426.7813,1019.5,1430.7813,1009.5,1434.7813,1013.5,1430.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="1015.5" y1="1430.7813" y2="1430.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="883.5" y="1425.9248">DigestUpdate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1461.1328" y2="1457.1328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1461.1328" y2="1465.1328"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="876.5" x2="1020.5" y1="1461.1328" y2="1461.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="893.5" y="1456.2764">ack</text><polygon fill="#A80036" points="1009.5,1494.4844,1019.5,1498.4844,1009.5,1502.4844,1013.5,1498.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="1015.5" y1="1498.4844" y2="1498.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="883.5" y="1493.6279">DigestClose</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1528.8359" y2="1524.8359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1528.8359" y2="1532.8359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="876.5" x2="1020.5" y1="1528.8359" y2="1528.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="893.5" y="1523.9795">CSM certificate</text><line style="stroke: #00FF00; stroke-width: 1.0;" x1="574.5" x2="584.5" y1="1559.1875" y2="1555.1875"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="574.5" x2="584.5" y1="1559.1875" y2="1563.1875"/><line style="stroke: #00FF00; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="574.5" x2="875.5" y1="1559.1875" y2="1559.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="591.5" y="1554.3311">CSM certificate</text><polygon fill="#0000FF" points="174,1601.8906,164,1605.8906,174,1609.8906,170,1605.8906" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="168" x2="573.5" y1="1605.8906" y2="1605.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="180" y="1584.6826">PO 3: SeRequest(AID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="180" y="1601.0342">List&lt;PoRequest&gt;)</text><path d="M13,1620.8906 L259,1620.8906 L259,1628.8906 L249,1638.8906 L13,1638.8906 L13,1620.8906 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="251" x="13" y="1620.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="28" y="1635.3857">'z' PO commands inside session</text><polygon fill="#A80036" points="49,1657.5938,39,1661.5938,49,1665.5938,45,1661.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43" x2="162" y1="1661.5938" y2="1661.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="55" y="1656.7373">ApduRequest</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="1691.9453" y2="1687.9453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="1691.9453" y2="1695.9453"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="38" x2="162" y1="1691.9453" y2="1691.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="45" y="1687.0889">ApduResponse</text><polygon fill="#A80036" points="49,1725.2969,39,1729.2969,49,1733.2969,45,1729.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43" x2="162" y1="1729.2969" y2="1729.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="55" y="1724.4404">CloseSession</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="1759.6484" y2="1755.6484"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="1759.6484" y2="1763.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="38" x2="162" y1="1759.6484" y2="1759.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="45" y="1754.792">PO certificate</text><polygon fill="#A80036" points="49,1786,39,1790,49,1794,45,1790" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43" x2="162" y1="1790" y2="1790"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="55" y="1785.1436">Ratification</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="1820.3516" y2="1816.3516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="151" y1="1820.3516" y2="1824.3516"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="38" x2="162" y1="1820.3516" y2="1820.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="45" y="1815.4951">ack</text><polygon fill="#0000FF" points="562.5,1846.7031,572.5,1850.7031,562.5,1854.7031,566.5,1850.7031" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="163" x2="568.5" y1="1850.7031" y2="1850.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="170" y="1845.8467">SeResponse(FCI, List&lt;ApduResponse&gt;)</text><polygon fill="#00FF00" points="864.5,1877.0547,874.5,1881.0547,864.5,1885.0547,868.5,1881.0547" style="stroke: #00FF00; stroke-width: 1.0;"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="574.5" x2="870.5" y1="1881.0547" y2="1881.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="581.5" y="1876.1982">CSM 3: SeRequest(noAID, List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="1009.5,1907.4063,1019.5,1911.4063,1009.5,1915.4063,1013.5,1911.4063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="1015.5" y1="1911.4063" y2="1911.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="883.5" y="1906.5498">ExternalAuthenticate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1941.7578" y2="1937.7578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876.5" x2="886.5" y1="1941.7578" y2="1945.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="876.5" x2="1020.5" y1="1941.7578" y2="1941.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="893.5" y="1936.9014">authentication status</text><line style="stroke: #00FF00; stroke-width: 1.0;" x1="574.5" x2="584.5" y1="1972.1094" y2="1968.1094"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="574.5" x2="584.5" y1="1972.1094" y2="1976.1094"/><line style="stroke: #00FF00; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="574.5" x2="875.5" y1="1972.1094" y2="1972.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="591.5" y="1967.2529">Authentification status</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="260.5" x2="270.5" y1="2002.4609" y2="1998.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260.5" x2="270.5" y1="2002.4609" y2="2006.4609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="260.5" x2="573.5" y1="2002.4609" y2="2002.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="277.5" y="1997.6045">SessionState_Closed, List&lt;PoResponse&gt;</text><!--MD5=[5e2bf53cf153c7d8ddc3efd21026c9ea]
@startuml
hide footbox

actor PO
participant "PO Reader" as POR
participant "Ticketing\napplication" as TA
participant "Calypso\nTerminal API" as KC
participant "SAM Reader" as SMR
actor SAM as SM

== PO Identification ==

TA->KC: transmit(SeRequest(AID,\nList<PoRequestOutSession>))
POR<[#0000FF]-KC: PO 1: SeRequest(AID, List<ApduRequest>)
PO<-POR: SelectApplication
PO- ->>POR: PO serial
group 'x' PO commands outside session
PO<-POR: ApduRequest
PO- ->>POR: ApduResponse
end
POR- -[#0000FF]>KC: SeResponse(FCI, List<ApduResponse>)
TA<- -KC: SeResponse(PO_FCI, List<PoResponse>))

== PO Secure Session ==

TA->KC: **processOpening**(PO_FCI, OpenSessionRequest,\nList<PoRequestInSession>)
KC-[#00FF00]>SMR: CSM 1: SeRequest(noAID,\nList<ApduRequest>)
SMR->SM: SelectDiversifier
SMR<<- -SM: ack
SMR->SM: GetChallenge
SMR<<- -SM: CSM challenge
KC<<[#00FF00]- -SMR: SeResponse(FCI, List<ApduResponse>)
TA<<- -KC: SessionStatus_Identified
POR<[#0000FF]-KC: PO 2: SeRequest(AID, List<ApduRequest>)
PO<-POR: OpenSession
PO- ->>POR: PO challenge
group 'y' PO commands inside session
PO<-POR: ApduRequest
PO- ->>POR: ApduResponse
end
POR- -[#0000FF]>KC: SeResponse(FCI, List<ApduResponse>)

TA<<- -KC: SessionState_Open, List<PoResponse>

TA->KC: **processClosing**(List<PoRequestInSession>,\nList<AnticipatedPoResponse>,\nPoRatificationCommand)

KC-[#00FF00]>SMR: CSM 2: SeRequest(noAID,\nList<ApduRequest>)
SMR->SM: DigestInit
SMR<<- -SM:ack
group '2 * y' session MAC updates
SMR->SM: DigestUpdate
SMR<<- -SM: ack
SMR->SM: DigestUpdate
SMR<<- -SM: ack
end
group '2 * z' session MAC updates
SMR->SM: DigestUpdate
SMR<<- -SM: ack
SMR->SM: DigestUpdate
SMR<<- -SM: ack
end
SMR->SM: DigestClose
SMR<<- -SM: CSM certificate
KC<<[#00FF00]- -SMR: CSM certificate
POR<[#0000FF]-KC: PO 3: SeRequest(AID,\nList<PoRequest>)
group 'z' PO commands inside session
PO<-POR: ApduRequest
PO- ->>POR: ApduResponse
end
PO<-POR: CloseSession
PO- ->>POR: PO certificate
PO<-POR: Ratification
PO- ->>POR: ack
POR- -[#0000FF]>KC: SeResponse(FCI, List<ApduResponse>)
KC-[#00FF00]>SMR: CSM 3: SeRequest(noAID, List<ApduRequest>)
SMR->SM: ExternalAuthenticate
SMR<<- -SM: authentication status
KC<<[#00FF00]- -SMR: Authentification status
TA<<- -KC: SessionState_Closed, List<PoResponse>
@enduml

PlantUML version 1.2020.07(Sun Apr 19 15:42:40 MUT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.6+8-b765.40
Operating System: Windows 10
Default Encoding: Cp1252
Language: fr
Country: FR
--></g></svg>